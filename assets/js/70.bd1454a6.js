(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{508:function(t,s,a){"use strict";a.r(s);var n=a(43),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"hmr-模块热更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hmr-模块热更新"}},[t._v("#")]),t._v(" HMR 模块热更新")]),t._v(" "),a("p",[t._v("模块热更新（"),a("code",[t._v("Hot Module Replacement")]),t._v("），简称 "),a("code",[t._v("HMR")]),t._v("。"),a("code",[t._v("webpack")]),t._v(" 中最强大的功能之一，极大地提高了开发效率。")]),t._v(" "),a("h2",{attrs:{id:"开启热更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启热更新"}},[t._v("#")]),t._v(" 开启热更新")]),t._v(" "),a("p",[t._v("如何开启 "),a("code",[t._v("HMR")]),t._v(" 呢？因为 "),a("code",[t._v("HMR")]),t._v(" 已经集成在 "),a("code",[t._v("webpack-dev-server")]),t._v(" 中，可以在运行 "),a("code",[t._v("webpack-dev-server")]),t._v(" 命令的时候使用 "),a("code",[t._v("--hot")]),t._v(" 参数开启热更新。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" webpack-dev-server --hot\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/jwchan1996/webpack-play/blob/main/09-webpack-hmr",target:"_blank",rel:"noopener noreferrer"}},[t._v("示例代码仓库"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("注意：在 webpack 5 与 webpack-cli 4.0 以上版本，webpack-dev-server 启动命令变为 webpack serve")])]),t._v(" "),a("p",[t._v("也可以通过配合文件开启，其中开启 "),a("code",[t._v("HMR")]),t._v(" 需要满足两个条件：")]),t._v(" "),a("ol",[a("li",[t._v("配置 "),a("code",[t._v("devServer.hot")]),t._v(" 为 "),a("code",[t._v("true")])]),t._v(" "),a("li",[t._v("配置 "),a("code",[t._v("webpack.HotModuleReplacementPlugin")]),t._v(" 插件")])]),t._v(" "),a("blockquote",[a("p",[t._v("请注意：webpack 要完全启用 HMR 需要使用 webpack.HotModuleReplacementPlugin。如果 webpack 或 webpack-dev-server 通过命令行添加 --hot 选项启动，这个插件会自动添加，所以不需要将它添加到 webpack.config.js 中。")])]),t._v(" "),a("p",[t._v("但是，实际使用 "),a("code",[t._v("webpack-dev-server")]),t._v(" 时发现，在 "),a("code",[t._v("webpack.config.js")]),t._v(" 中只配置 "),a("code",[t._v("devServer.hot")]),t._v(" 为 "),a("code",[t._v("true")]),t._v("，而未配置 "),a("code",[t._v("webpack.HotModuleReplacementPlugin")]),t._v(" 的情况下，依赖可以正常使用 "),a("code",[t._v("HMR")]),t._v("。通过 "),a("code",[t._v("webpack-dev-server")]),t._v(" 源码可知，它内部通过判断自动完成了这个插件的加载使用。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    hot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("webpack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HotModuleReplacementPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("至此，我们发现修改样式文件可以实现不刷新页面更新内容，而修改 "),a("code",[t._v("js")]),t._v(" 文件时页面却刷新了。")]),t._v(" "),a("p",[a("code",[t._v("webpack")]),t._v(" 中的 "),a("code",[t._v("HMR")]),t._v(" 并不是开箱即用的，需要我们手动处理模块热更新逻辑。其中样式文件是通过 "),a("code",[t._v("style-loader")]),t._v(" 处理了热更新逻辑，因为修改后的样式只要覆盖之前页面的样式即可实现热更新。而 "),a("code",[t._v("js")]),t._v(" 文件的修改，"),a("code",[t._v("js")]),t._v(" 的执行方式都是没有规律的，"),a("code",[t._v("webpack")]),t._v(" 无法提供一个通用的实现热更新逻辑的 "),a("code",[t._v("Loader")]),t._v("。")]),t._v(" "),a("p",[t._v("那为什么有些项目不需要手动实现 "),a("code",[t._v("js")]),t._v(" 的热更新逻辑呢？因为有些项目是通过脚手架创建的，"),a("code",[t._v("js")]),t._v(" 文件是按照一定的规范的，脚手架项目内部集成了 "),a("code",[t._v("HMR")]),t._v(" 方案。")]),t._v(" "),a("p",[a("strong",[t._v("总结")]),t._v("：我们需要手动处理 "),a("code",[t._v("js")]),t._v(" 模块更新后的热更新逻辑。")]),t._v(" "),a("h2",{attrs:{id:"使用-hmr-api-处理热更新逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-hmr-api-处理热更新逻辑"}},[t._v("#")]),t._v(" 使用 HMR API 处理热更新逻辑")]),t._v(" "),a("p",[a("code",[t._v("webpack.HotModuleReplacementPlugin")]),t._v(" 为 "),a("code",[t._v("js")]),t._v(" 提供了一套处理 "),a("code",[t._v("HMR")]),t._v(" 的 "),a("code",[t._v("API")]),t._v("，我们需要使用这些 "),a("code",[t._v("API")]),t._v(" 去处理 "),a("code",[t._v("js")]),t._v(" 更改后的代码如何更新到当前页面中。")]),t._v(" "),a("p",[t._v("这套 "),a("code",[t._v("API")]),t._v(" 为 "),a("code",[t._v("module")]),t._v(" 对象提供了 "),a("code",[t._v("hot")]),t._v(" 属性，这个属性也是个对象，这个对象是 "),a("code",[t._v("HMR")]),t._v(" 的核心对象。他提供了一个 "),a("code",[t._v("accept")]),t._v(" 方法，用来注册当某个模块更新过后的处理函数。这个 "),a("code",[t._v("accept")]),t._v(" 方法接收的第一个参数是依赖模块的路径，第二个是依赖更新过后的处理函数。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src/main.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" createEditor "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./editor'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" background "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./bg.png'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./global.css'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" editor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEditor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("editor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" background\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ============ 以下用于处理 HMR，与业务代码无关 ============")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack 开启热更新会注入 module.hot 变量，由此判断")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听对应模块，更新会触发对应函数")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./editor'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'editor 模块更新了，需要这里手动处理热替换逻辑'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("一旦使用 "),a("code",[t._v("API")]),t._v(" 对文件进行 "),a("code",[t._v("HMR")]),t._v(" 逻辑处理了，修改文件就不会再触发自动刷新页面了。")]),t._v(" "),a("h3",{attrs:{id:"处理-js-模块的热更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理-js-模块的热更新"}},[t._v("#")]),t._v(" 处理 JS 模块的热更新")]),t._v(" "),a("p",[t._v("下面是专门针对当前 "),a("code",[t._v("editor.js")]),t._v(" 文件的热更新逻辑，并非是通用的热更新处理逻辑。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src/main.js")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ============ 以下用于处理 HMR，与业务代码无关 ============")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack 开启热更新会注入 module.hot 变量，由此判断")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保存上一次的编辑器模块状态")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastEditor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" editor\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听对应模块，更新会触发对应函数")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./editor'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'editor 模块更新了，需要这里手动处理热替换逻辑'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lastEditor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastEditor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newEditor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEditor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    newEditor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newEditor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    lastEditor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newEditor\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"处理图片模块的热更新逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理图片模块的热更新逻辑"}},[t._v("#")]),t._v(" 处理图片模块的热更新逻辑")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// src/main.js")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./bg.png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" background\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("background"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"hmr-注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hmr-注意事项"}},[t._v("#")]),t._v(" HMR 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("如果热更新逻辑出现错误，会自动使用页面刷新的方式去更新页面。这样一来，就不利于发现错误信息，而且也无法实现无刷新更新页面。我们可以将 "),a("code",[t._v("devServer.hot")]),t._v(" 替换为 "),a("code",[t._v("devServer.hotOnly")]),t._v("，这样在热更新逻辑出错的情况下是不会进行刷新的。")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// hot: true,")]),t._v("\n  hotOnly"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("没启用 "),a("code",[t._v("HMR")]),t._v(" 的情况下，"),a("code",[t._v("HMR API")]),t._v(" 报错，那就需要在编写 "),a("code",[t._v("HMR")]),t._v(" 逻辑的时候判断一下是否启用 "),a("code",[t._v("HMR")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 热更新逻辑")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("代码中写了很多业务无关代码。在没开启 "),a("code",[t._v("HMR")]),t._v(" 的情况下，只进行 "),a("code",[t._v("webpack")]),t._v(" 打包，那些 "),a("code",[t._v("HMR")]),t._v(" 相关的判断代码会被编译为：")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);