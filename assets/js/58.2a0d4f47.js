(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{485:function(a,t,s){"use strict";s.r(t);var e=s(43),c=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker-访问外部-https-的数字证书验证问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-访问外部-https-的数字证书验证问题"}},[a._v("#")]),a._v(" docker 访问外部 https 的数字证书验证问题")]),a._v(" "),s("p",[a._v("我们在构建 "),s("code",[a._v("docker")]),a._v(" 镜像时一般使用的是 "),s("code",[a._v("alpine linux")]),a._v(" 系统，默认是不带 "),s("code",[a._v("ca-certificates")]),a._v(" 根证书的，导致无法识别外部 https 携带的数字证书。")]),a._v(" "),s("p",[a._v("那么，在访问的时候就会抛出 "),s("code",[a._v("x509: certificate signed by unknown authority")]),a._v(" 的错误，导致 "),s("code",[a._v("docker")]),a._v(" 容器的接口服务返回 "),s("code",[a._v("500")]),a._v("。")]),a._v(" "),s("p",[a._v("为了解决证书验证的问题，我们要在构建 "),s("code",[a._v("docker")]),a._v(" 镜像的时候把 "),s("code",[a._v("ca-certificates")]),a._v(" 根证书给装上，这样就能识别来自外部 "),s("code",[a._v("https")]),a._v(" 的数字证书了。")]),a._v(" "),s("p",[a._v("在编辑 "),s("code",[a._v("Dockerfile")]),a._v(" 的时候加入以下命令即可：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("RUN apk --no-cache "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" ca-certificates "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" update-ca-certificates\n")])])]),s("p",[a._v("如果不想重新构建镜像的话，可以直接进入容器：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'容器ID或容器名称'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])]),s("p",[a._v("然后执行安装根证书命令：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ apk --no-cache "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" ca-certificates "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" update-ca-certificates\n")])])]),s("p",[a._v("出现以下警告，可以忽略：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("WARNING: ca-certificates.crt does not contain exactly one certificate or CRL: skipping\n")])])]),s("p",[a._v("然后重启容器即可：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker restart "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'容器ID或容器名称'")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=c.exports}}]);